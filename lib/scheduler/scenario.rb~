class Scenario
  attr_accessor :pairings
  attr_accessor :classes, :students

  def initialize(c, s, p = nil)
    @classes = c
    @students = s
    @pairings = p
    @pairings = [] if !@pairings
    
    remove_unfinalized_pairings!
    fill_in_possible_pairings!
    
  end

  def rating
    rating = 0

    @classes.each do |c|
      rating.next if paired_classes.include? c
    end

    rating
  end

  private

  def fill_in_possible_pairings!
    @students.each do |student|
      @pairings.concat(available_classes_for_student(student).map { |c| Pairing.new(student, c) })
    end
  end

  def paired_classes
    pairings.find_all { |p| p.chem_class if p.finalized? }.compact
  end

  def available_classes_for_student(student)
    @classes.map do |c| 
      c if !c.meeting_times.map do |mt| 
        student.has_time_open?(mt) && student.can_accept_responsibility?(self, c)
      end.include?(false) && paired_classes.include?(c)
    end.compact
  end

  def remove_unfinalized_pairings!
    @pairings = @pairings.find_all { |p| p.finalized? }
  end
end
